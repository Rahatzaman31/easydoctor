import{g as e,r,j as s,L as t}from"./react-vendor-DK4SYnaI.js";import{s as a,i as o}from"./index-DdJT-0ac.js";import"./vendor-Ct5Y5_H5.js";import"./editor-vendor-DQbJo6Zw.js";import"./supabase-vendor-CZ5UGAb5.js";function n(){e();const[n,i]=r.useState(!0),[d,c]=r.useState(""),[l,m]=r.useState(!1),[u,x]=r.useState(""),[p,h]=r.useState(""),g=r.useRef(!1);return r.useEffect(()=>{if(g.current)return;const e=new URLSearchParams(window.location.search),r=e.get("paymentID"),s=e.get("status");if(r&&s){const e=`product_order_callback_${r}`,t=sessionStorage.getItem(e);if("completed"===t||"processing"===t)return void i(!1);g.current=!0,sessionStorage.setItem(e,"processing"),async function(e,r,s){const t=sessionStorage.getItem("pendingProductOrder");if(!t)return c("সেশন ডাটা পাওয়া যায়নি। অনুগ্রহ করে আবার অর্ডার করুন।"),void i(!1);if("success"===r)try{const r=await fetch("/api/bkash/execute-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentID:e})}),n=await r.json();n.success?(h(n.trxID),await async function(e,r,s,t){try{const n=JSON.parse(s);if(!a||!o)return c("ডাটাবেস সংযোগ নেই।"),void(t&&sessionStorage.removeItem(t));const{error:i}=await a.from("product_orders").insert([{order_number:n.orderNumber,product_id:n.productId,product_name:n.productName,product_price:n.productPrice,quantity:n.quantity,customer_name:n.orderForm.customer_name,customer_phone:n.orderForm.customer_phone,customer_email:n.orderForm.customer_email||null,delivery_address:n.orderForm.delivery_address,delivery_area:n.orderForm.delivery_area,delivery_charge:n.deliveryCharge,subtotal:n.subtotal,total_amount:n.totalAmount,payment_method:"bkash",payment_status:"completed",bkash_payment_id:r,bkash_trx_id:e,order_status:"confirmed",order_notes:n.orderForm.order_notes||null}]);if(i)throw i;t&&sessionStorage.setItem(t,"completed"),sessionStorage.removeItem("pendingProductOrder"),sessionStorage.removeItem("paymentType"),x(n.orderNumber),m(!0)}catch(n){c("অর্ডার সংরক্ষণ করতে সমস্যা হয়েছে। অনুগ্রহ করে যোগাযোগ করুন।"),t&&sessionStorage.removeItem(t)}}(n.trxID,e,t,s)):(c(n.message||"পেমেন্ট যাচাই করতে সমস্যা হয়েছে।"),s&&sessionStorage.removeItem(s))}catch(n){c("পেমেন্ট যাচাই করতে সমস্যা হয়েছে।"),s&&sessionStorage.removeItem(s)}else"failure"!==r&&"cancel"!==r||(c("পেমেন্ট বাতিল হয়েছে বা ব্যর্থ হয়েছে।"),s&&sessionStorage.removeItem(s));i(!1)}(r,s,e)}else c("পেমেন্ট তথ্য পাওয়া যায়নি।"),i(!1)},[]),n?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary-600 border-t-transparent mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"পেমেন্ট যাচাই করা হচ্ছে..."}),s.jsx("p",{className:"text-gray-500",children:"অনুগ্রহ করে অপেক্ষা করুন"})]})}):d?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx("svg",{className:"w-10 h-10 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"অর্ডার ব্যর্থ হয়েছে"}),s.jsx("p",{className:"text-gray-600 mb-6",children:d}),s.jsx(t,{to:"/medi-products",className:"inline-block bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700",children:"পুনরায় চেষ্টা করুন"})]})}):l?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx("svg",{className:"w-10 h-10 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"অর্ডার সফল!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"আপনার অর্ডার সফলভাবে সম্পন্ন হয়েছে। শীঘ্রই আমরা আপনার সাথে যোগাযোগ করব।"}),s.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 text-left",children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{className:"text-gray-500",children:"অর্ডার নম্বর"}),s.jsx("span",{className:"font-bold text-gray-800",children:u})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"ট্রানজেকশন ID"}),s.jsx("span",{className:"font-mono text-sm text-gray-800",children:p})]})]}),s.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-6",children:s.jsx("p",{className:"text-blue-700 text-sm",children:"অনুগ্রহ করে এই তথ্যগুলো সংরক্ষণ করুন। ডেলিভারির সময় প্রয়োজন হতে পারে।"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(t,{to:"/medi-products",className:"block w-full bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700",children:"আরো পণ্য দেখুন"}),s.jsx(t,{to:"/",className:"block w-full bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-200",children:"হোম পেজে যান"})]})]})}):null}export{n as default};
