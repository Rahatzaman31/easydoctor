import{f as e,g as t,r as s,j as a,L as n}from"./react-vendor-KvxbO3mS.js";import{s as r,i}from"./index-D0fMXm6Q.js";import{o as l}from"./vendor-ZcaEhcQo.js";import"./editor-vendor-CSPj58cm.js";import"./supabase-DvSZys4T.js";const o=e=>{const t=["০","১","২","৩","৪","৫","৬","৭","৮","৯"];return String(e).replace(/[0-9]/g,e=>t[parseInt(e)])},d={"রংপুর":["রংপুর সদর","গঙ্গাচড়া","তারাগঞ্জ","বদরগঞ্জ","মিঠাপুকুর","পীরগঞ্জ","কাউনিয়া","পীরগাছা"],"দিনাজপুর":["দিনাজপুর সদর","বীরগঞ্জ","বিরামপুর","বোচাগঞ্জ","চিরিরবন্দর","ফুলবাড়ী","ঘোড়াঘাট","হাকিমপুর","কাহারোল","খানসামা","নবাবগঞ্জ","পার্বতীপুর"],"কুড়িগ্রাম":["কুড়িগ্রাম সদর","উলিপুর","চিলমারী","নাগেশ্বরী","ভুরুঙ্গামারী","ফুলবাড়ী","রাজারহাট","রৌমারী","রাজীবপুর"],"লালমনিরহাট":["লালমনিরহাট সদর","আদিতমারী","কালীগঞ্জ","হাতীবান্ধা","পাটগ্রাম"],"নীলফামারী":["নীলফামারী সদর","সৈয়দপুর","ডোমার","ডিমলা","জলঢাকা","কিশোরগঞ্জ"],"গাইবান্ধা":["গাইবান্ধা সদর","গোবিন্দগঞ্জ","পলাশবাড়ী","সাদুল্লাপুর","সাঘাটা","সুন্দরগঞ্জ","ফুলছড়ি"],"ঠাকুরগাঁও":["ঠাকুরগাঁও সদর","পীরগঞ্জ","রাণীশংকৈল","হরিপুর","বালিয়াডাঙ্গী"],"পঞ্চগড়":["পঞ্চগড় সদর","বোদা","আটোয়ারী","দেবীগঞ্জ","তেতুলিয়া"]},c=Object.keys(d),m=[{id:"sunday",name:"রবি"},{id:"monday",name:"সোম"},{id:"tuesday",name:"মঙ্গল"},{id:"wednesday",name:"বুধ"},{id:"thursday",name:"বৃহঃ"},{id:"friday",name:"শুক্র"},{id:"saturday",name:"শনি"}],x=e=>["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()],p=()=>{const e=[],t=new Date;for(let s=1;s<=8;s++){const a=new Date(t);a.setDate(t.getDate()+s);const n=x(a),r=m.find(e=>e.id===n)?.name||"";e.push({date:a,dateStr:a.toISOString().split("T")[0],dayId:n,dayName:r,dayNum:a.getDate(),month:a.toLocaleDateString("bn-BD",{month:"short"})})}return e},h=100;function g(){const{doctorId:m}=e(),x=t(),g=s.useRef(null),[u,f]=s.useState(null),[j,b]=s.useState(!0),[y,N]=s.useState(!1),[v,k]=s.useState(!1),[w,_]=s.useState(""),[S,I]=s.useState("form"),[C,D]=s.useState(""),[L,z]=s.useState(""),[A,M]=s.useState(null),[P,q]=s.useState(!1),[B,O]=s.useState({}),[R,W]=s.useState(!1),[X,T]=s.useState(null),[E,J]=s.useState({top:0,left:0}),[V,U]=s.useState({patient_name:"",patient_phone:"",patient_age:"",patient_gender:"male",district:"",upazila:"",appointment_date:"",problem_description:""});function $(e){const{name:t,value:s}=e.target;U("district"===t?{...V,district:s,upazila:""}:{...V,[t]:s})}s.useEffect(()=>{!async function(){try{if(!r||!i)return void b(!1);let e,t;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(m)){const s=await r.from("doctors").select("*").eq("id",m).single();e=s.data,t=s.error}else{const s=await r.from("doctors").select("*").eq("slug",m).single();if(e=s.data,t=s.error,t&&!e){const s=await r.from("doctors").select("*").eq("id",m).single();e=s.data,t=s.error}}if(t)throw t;f(e)}catch(e){}finally{b(!1)}}()},[m]),s.useEffect(()=>{u&&async function(){try{if(!r||!i||!u)return;const e=p().map(e=>e.dateStr),{data:t,error:s}=await r.from("paid_appointments").select("appointment_date").eq("doctor_id",m).in("appointment_date",e);if(s)return;const a={};e.forEach(e=>{const s=t?.filter(t=>t.appointment_date===e).length||0;a[e]=s}),O(a)}catch(e){}}()},[u]);const F=s.useRef(!1);if(s.useEffect(()=>{const e=new URLSearchParams(window.location.search),t=e.get("paymentID"),s=e.get("status");if(t&&s){const e=`payment_callback_${t}`,n=sessionStorage.getItem(e);if("completed"===n||"processing"===n||F.current)return void window.history.replaceState({},document.title,window.location.pathname);F.current=!0,sessionStorage.setItem(e,"processing");const l=sessionStorage.getItem("pendingPaidAppointment");if(l)try{const e=JSON.parse(l);U(e.formData)}catch(a){}!async function(e,t,s){const n=sessionStorage.getItem("pendingPaidAppointment");if(!n)return D("সেশন ডাটা পাওয়া যায়নি। অনুগ্রহ করে আবার বুকিং শুরু করুন।"),I("form"),s&&sessionStorage.removeItem(s),void window.history.replaceState({},document.title,window.location.pathname);if("success"===t){N(!0);try{const t=await fetch("/api/bkash/execute-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentID:e})}),n=await t.json();n.success?(z(n.trxID),await async function(e,t,s){try{if(!r||!i)return alert("ডাটাবেস সংযোগ নেই। অনুগ্রহ করে পরে চেষ্টা করুন।"),void(s&&sessionStorage.removeItem(s));const{data:n}=await r.from("paid_appointments").select("id, booking_ref").eq("payment_id",t).maybeSingle();if(n)return s&&sessionStorage.setItem(s,"completed"),sessionStorage.removeItem("pendingPaidAppointment"),_(n.booking_ref),void k(!0);const l=sessionStorage.getItem("pendingPaidAppointment");if(!l)return alert("সেশন ডাটা পাওয়া যায়নি। পেমেন্ট সফল হয়েছে (TrxID: "+e+")। অনুগ্রহ করে আমাদের সাথে যোগাযোগ করুন।"),void(s&&sessionStorage.removeItem(s));let o=V,d=u?.name,c=m,x=u?.category_name,p=u?.chamber_address;try{const e=JSON.parse(l);if(o=e.formData||V,d=e.doctorName||u?.name,c=e.doctorId||m,x=e.doctorCategory||u?.category_name,p=e.doctorChamberAddress||u?.chamber_address,!o.patient_name||!o.patient_phone)throw new Error("Incomplete form data")}catch(a){return alert("ডাটা প্রসেস করতে সমস্যা। পেমেন্ট সফল (TrxID: "+e+")। আমাদের সাথে যোগাযোগ করুন।"),void(s&&sessionStorage.removeItem(s))}const g="PD"+Date.now().toString().slice(-8),f={doctor_id:c,doctor_name:d,doctor_category:x,chamber_address:p,...o,booking_ref:g,status:"confirmed",payment_status:"paid",payment_method:"bkash",payment_amount:h,transaction_id:e,payment_id:t},{error:j}=await r.from("paid_appointments").insert([f]);if(j){if("23505"===j.code){const{data:e}=await r.from("paid_appointments").select("booking_ref").eq("payment_id",t).single();if(e)return _(e.booking_ref),k(!0),s&&sessionStorage.setItem(s,"completed"),void sessionStorage.removeItem("pendingPaidAppointment")}throw j}s&&sessionStorage.setItem(s,"completed"),sessionStorage.removeItem("pendingPaidAppointment"),M({...f,booking_ref:g,doctor_category:x,chamber_address:p}),_(g),k(!0)}catch(n){alert("অ্যাপয়েন্টমেন্ট সংরক্ষণ করতে সমস্যা হয়েছে। অনুগ্রহ করে আমাদের সাথে যোগাযোগ করুন। Transaction ID: "+e),s&&sessionStorage.removeItem(s)}}(n.trxID,e,s)):(D(n.message||"পেমেন্ট যাচাই করতে সমস্যা হয়েছে।"),I("payment"),s&&sessionStorage.removeItem(s))}catch(l){D("পেমেন্ট যাচাই করতে সমস্যা হয়েছে।"),I("payment"),s&&sessionStorage.removeItem(s)}finally{N(!1)}}else"failure"!==t&&"cancel"!==t||(D("পেমেন্ট বাতিল হয়েছে বা ব্যর্থ হয়েছে। তথ্য সংরক্ষিত আছে, আবার চেষ্টা করুন।"),I("payment"),s&&sessionStorage.removeItem(s));window.history.replaceState({},document.title,window.location.pathname)}(t,s,e)}},[]),j)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-600"})});const H=e=>{if(!e)return"";return new Date(e).toLocaleDateString("bn-BD",{year:"numeric",month:"long",day:"numeric",weekday:"long"})},K=async()=>{if(g.current){q(!0);try{const e=await l(g.current,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1}),t=document.createElement("a");t.download=`পেইড_সিরিয়াল_${w}.png`,t.href=e.toDataURL("image/png"),t.click()}catch(e){alert("ডাউনলোড করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।")}finally{q(!1)}}};if(v){const e=A||V;return a.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-2 sm:p-4",children:a.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-sm sm:max-w-md max-h-[95vh] flex flex-col",children:[a.jsxs("div",{ref:g,className:"bg-white rounded-t-xl sm:rounded-t-2xl overflow-hidden flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"bg-white p-4 sm:p-5 text-center sticky top-0 border-b border-gray-100",children:[a.jsx("img",{src:"/logo-icon.png",alt:"Logo",className:"w-14 h-14 sm:w-16 sm:h-16 mx-auto mb-2 rounded-full"}),a.jsx("h1",{className:"text-base sm:text-lg font-bold text-gray-800",children:"Rangpur Doctor Appointment"})]}),a.jsxs("div",{className:"p-3 sm:p-4",children:[a.jsxs("div",{className:"bg-pink-50 border-2 border-pink-200 rounded-lg p-3 mb-4 text-center",children:[a.jsx("p",{className:"text-gray-600 text-xs mb-0.5",children:"বুকিং রেফারেন্স"}),a.jsx("p",{className:"text-xl sm:text-2xl font-bold text-pink-600",children:w})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 sm:p-3",children:[a.jsxs("h3",{className:"font-semibold text-gray-700 text-xs sm:text-sm mb-2 flex items-center gap-1.5",children:[a.jsx("svg",{className:"w-4 h-4 text-pink-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"ডাক্তার তথ্য"]}),a.jsxs("div",{className:"space-y-2 text-xs sm:text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"ডাক্তার"}),a.jsx("p",{className:"font-medium text-gray-800",children:e.doctor_name||u?.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"বিভাগ"}),a.jsx("p",{className:"font-medium text-gray-800",children:e.doctor_category||u?.category_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"অ্যাপয়েন্টমেন্ট তারিখ"}),a.jsx("p",{className:"font-medium text-pink-600",children:H(e.appointment_date)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"চেম্বার ঠিকানা"}),a.jsx("p",{className:"font-medium text-gray-800",children:e.chamber_address||u?.chamber_address||"-"})]})]})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 sm:p-3",children:[a.jsxs("h3",{className:"font-semibold text-gray-700 text-xs sm:text-sm mb-2 flex items-center gap-1.5",children:[a.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"রোগীর তথ্য"]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs sm:text-sm",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"নাম"}),a.jsx("p",{className:"font-medium text-gray-800",children:e.patient_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"বয়স/লিঙ্গ"}),a.jsxs("p",{className:"font-medium text-gray-800",children:[o(e.patient_age),"/",(G=e.patient_gender,"male"===G?"পুরুষ":"female"===G?"মহিলা":"অন্যান্য").charAt(0)]})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"মোবাইল"}),a.jsx("p",{className:"font-medium text-gray-800",children:e.patient_phone})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"ঠিকানা"}),a.jsxs("p",{className:"font-medium text-gray-800 text-[11px] sm:text-xs",children:[e.upazila,", ",e.district]})]})]})]}),a.jsxs("div",{className:"bg-green-50 rounded-lg p-2.5 sm:p-3",children:[a.jsxs("h3",{className:"font-semibold text-green-700 text-xs sm:text-sm mb-2 flex items-center gap-1.5",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"পেমেন্ট তথ্য"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs sm:text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"মাধ্যম"}),a.jsx("p",{className:"font-medium text-green-700",children:"বিকাশ"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"পরিশোধিত"}),a.jsxs("p",{className:"font-medium text-green-700",children:[o(h)," টাকা"]})]}),L&&a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"ট্রানজেকশন আইডি"}),a.jsx("p",{className:"font-medium text-green-700 text-xs",children:L})]})]})]}),e.problem_description&&a.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 sm:p-3",children:[a.jsx("p",{className:"text-gray-500 text-[10px] sm:text-xs",children:"সমস্যার বিবরণ"}),a.jsx("p",{className:"font-medium text-gray-800 text-xs sm:text-sm",children:e.problem_description})]}),a.jsx("div",{className:"bg-pink-50 border border-pink-200 rounded-lg p-2 text-center",children:a.jsx("p",{className:"text-[10px] sm:text-xs text-pink-700",children:"এই তথ্যটি সংরক্ষণ করুন এবং চেম্বারে দেখান"})})]})]})]}),a.jsxs("div",{className:"p-3 border-t bg-gray-50 rounded-b-xl sm:rounded-b-2xl flex gap-2 shrink-0",children:[a.jsx("button",{onClick:()=>x("/"),className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2.5 px-3 rounded-lg text-sm transition-colors",children:"হোম পেইজ"}),a.jsx("button",{onClick:K,disabled:P,className:"flex-1 bg-pink-600 hover:bg-pink-700 text-white font-medium py-2.5 px-3 rounded-lg text-sm transition-colors disabled:opacity-50 flex items-center justify-center gap-1.5",children:P?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a.jsx("span",{children:"ডাউনলোড..."})]}):a.jsxs(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),a.jsx("span",{children:"ডাউনলোড"})]})})]})]})})}var G;return u?a.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[a.jsxs(n,{to:`/doctor/${u?.slug||m}`,className:"text-pink-600 hover:underline mb-6 inline-flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ফিরে যান"]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-pink-600 p-6 text-white",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"পেইড সিরিয়াল"}),a.jsx("p",{className:"text-pink-100 text-sm",children:"প্রিমিয়াম সুবিধা সহ"})]})]}),a.jsxs("p",{className:"text-pink-200 mt-2",children:[u.name," - ",u.category_name]})]}),"form"===S?a.jsxs("form",{onSubmit:async function(e){e.preventDefault(),(V.patient_name.trim()?V.patient_phone.trim()?V.patient_age.trim()?V.district?V.upazila?V.appointment_date||(alert("অনুগ্রহ করে অ্যাপয়েন্টমেন্টের তারিখ নির্বাচন করুন।"),0):(alert("অনুগ্রহ করে উপজেলা নির্বাচন করুন।"),0):(alert("অনুগ্রহ করে জেলা নির্বাচন করুন।"),0):(alert("অনুগ্রহ করে বয়স লিখুন।"),0):(alert("অনুগ্রহ করে মোবাইল নম্বর লিখুন।"),0):(alert("অনুগ্রহ করে রোগীর নাম লিখুন।"),0))&&I("payment")},className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-orange-50 rounded-lg p-4 mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center pb-3 border-b border-pink-200",children:[a.jsx("span",{className:"text-gray-600",children:"পেইড সিরিয়াল ফি:"}),a.jsxs("span",{className:"text-xl font-bold text-pink-600",children:[o(h)," টাকা"]})]}),a.jsxs("p",{className:"text-sm text-gray-600 mt-3 bg-white p-2 rounded",children:[a.jsx("span",{className:"font-medium text-pink-700",children:"বিকাশ পেমেন্ট:"})," পেইড সিরিয়াল ফি (",o(h)," টাকা) বিকাশে প্রদান করুন।"]})]}),a.jsxs("div",{className:"bg-pink-50 border border-pink-200 rounded-lg p-4",children:[a.jsx("h3",{className:"font-semibold text-pink-800 mb-3",children:"পেইড সিরিয়ালের সুবিধা:"}),a.jsxs("ul",{className:"space-y-2 text-sm text-pink-700",children:[a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-pink-500",children:"✓"}),a.jsx("span",{children:"সিরিয়াল প্রথমে হবে - অপেক্ষার সময় কম"})]}),a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-pink-500",children:"✓"}),a.jsx("span",{children:"আমাদের একজন প্রতিনিধি উপস্থিত থাকবে"})]}),a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-pink-500",children:"✓"}),a.jsx("span",{children:"প্রেসক্রিপশন অনলাইনে - বুকিং আইডি দিয়ে ডাউনলোড করা যাবে"})]}),a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-pink-500",children:"✓"}),a.jsx("span",{children:"আমাদের কাছে ঔষুধ কিনলে ১০% ডিসকাউন্ট"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"রোগীর নাম *"}),a.jsx("input",{type:"text",name:"patient_name",required:!0,className:"input-field",placeholder:"আপনার পুরো নাম লিখুন",value:V.patient_name,onChange:$})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"মোবাইল নম্বর (বিকাশ) *"}),a.jsx("input",{type:"tel",name:"patient_phone",required:!0,className:"input-field",placeholder:"01XXXXXXXXX",value:V.patient_phone,onChange:$}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"এই নম্বরে বিকাশ পেমেন্ট করা হবে"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"বয়স *"}),a.jsx("input",{type:"number",name:"patient_age",required:!0,min:"1",max:"120",className:"input-field",placeholder:"বছর",value:V.patient_age,onChange:$})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"লিঙ্গ *"}),a.jsxs("select",{name:"patient_gender",required:!0,className:"input-field",value:V.patient_gender,onChange:$,children:[a.jsx("option",{value:"male",children:"পুরুষ"}),a.jsx("option",{value:"female",children:"মহিলা"}),a.jsx("option",{value:"other",children:"অন্যান্য"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"জেলা *"}),a.jsxs("select",{name:"district",required:!0,className:"input-field",value:V.district,onChange:$,children:[a.jsx("option",{value:"",children:"জেলা নির্বাচন করুন"}),c.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"উপজেলা *"}),a.jsxs("select",{name:"upazila",required:!0,className:"input-field",value:V.upazila,onChange:$,disabled:!V.district,children:[a.jsx("option",{value:"",children:V.district?"উপজেলা নির্বাচন করুন":"প্রথমে জেলা নির্বাচন করুন"}),V.district&&d[V.district]?.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2 flex-wrap",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"অ্যাপয়েন্টমেন্টের তারিখ *"}),a.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-pink-50 to-pink-100 border border-pink-200 px-3 py-1.5 rounded-lg",children:[a.jsx("svg",{className:"w-4 h-4 text-pink-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),V.appointment_date&&X?a.jsxs("span",{className:"text-sm font-medium text-pink-700",children:["অবশিষ্ট সিরিয়াল: ",X.limit?a.jsxs("span",{className:"font-bold",children:[o(X.remaining)," টি"]}):a.jsx("span",{children:"সীমাহীন"})]}):a.jsxs("span",{className:"text-sm font-medium text-pink-600",children:["দৈনিক লিমিট: ",u?.paid_appointment_limit?a.jsxs("span",{className:"font-bold",children:[o(u.paid_appointment_limit)," টি"]}):a.jsx("span",{children:"সীমাহীন"})]})]})]}),a.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:(()=>{const e=p();let t=[];try{t=u?.schedule_days?JSON.parse(u.schedule_days):[]}catch(n){t=[]}const s=u?.paid_appointment_limit;return e.map(e=>{const n=t.length>0&&!t.includes(e.dayId),r=B[e.dateStr]||0,i=s&&r>=s,l=V.appointment_date===e.dateStr,d=n||i;return a.jsx("button",{type:"button",disabled:d,onClick:t=>!d&&function(e,t){if(t)return;const s=u?.paid_appointment_limit,a=B[e.dateStr]||0,n=s?s-a:null;U({...V,appointment_date:e.dateStr}),T({date:e.dateStr,dayNum:e.dayNum,month:e.month,remaining:n,limit:s})}(e,i),className:"relative p-2.5 sm:p-3 rounded-xl border-2 text-center transition-all duration-200 "+(i?"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-300 text-orange-500 cursor-not-allowed":n?"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 text-gray-400 cursor-not-allowed":l?"bg-gradient-to-br from-pink-500 to-pink-600 border-pink-500 text-white shadow-xl shadow-pink-200 scale-[1.03] ring-2 ring-pink-300 ring-offset-1":"bg-white border-gray-200 text-gray-700 hover:border-pink-400 hover:bg-gradient-to-br hover:from-pink-50 hover:to-white hover:shadow-md"),children:i?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[a.jsx("div",{className:"text-[10px] sm:text-xs font-medium text-orange-600 mb-0.5",children:e.dayName}),a.jsx("div",{className:"text-base sm:text-lg font-bold text-orange-500",children:o(e.dayNum)}),a.jsx("div",{className:"text-[9px] sm:text-[10px] font-semibold text-orange-400 bg-orange-100 px-1.5 py-0.5 rounded mt-0.5",children:"পূর্ণ"})]}):n?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[a.jsx("div",{className:"text-[10px] sm:text-xs font-medium text-gray-400 mb-0.5",children:e.dayName}),a.jsx("div",{className:"text-base sm:text-lg font-bold text-gray-400",children:o(e.dayNum)}),a.jsx("div",{className:"text-[9px] sm:text-[10px] font-medium text-gray-400",children:"বন্ধ"})]}):a.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[a.jsx("div",{className:"text-[10px] sm:text-xs font-semibold mb-0.5 "+(l?"text-pink-100":"text-pink-500"),children:e.dayName}),a.jsx("div",{className:"text-xl sm:text-2xl font-bold leading-none "+(l?"text-white":"text-gray-800"),children:o(e.dayNum)}),a.jsx("div",{className:"text-[10px] sm:text-xs "+(l?"text-pink-100":"text-gray-500"),children:e.month})]})},e.dateStr)})})()}),!V.appointment_date&&a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"উপরে থেকে তারিখ নির্বাচন করুন"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"সমস্যার বিবরণ"}),a.jsx("textarea",{name:"problem_description",rows:"3",className:"input-field",placeholder:"আপনার সমস্যা সংক্ষেপে লিখুন (ঐচ্ছিক)",value:V.problem_description,onChange:$})]}),a.jsx("button",{type:"submit",className:"w-full py-3 text-lg bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white rounded-xl font-semibold transition-all shadow-lg",children:"পেমেন্টে এগিয়ে যান"})]}):a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx("img",{src:"https://www.bkash.com/sites/default/files/bkash_favicon.ico",alt:"bKash",className:"w-12 h-12",onError:e=>{e.target.style.display="none"}})}),a.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"বিকাশ পেমেন্ট"}),a.jsx("p",{className:"text-gray-600",children:"পেমেন্ট সম্পন্ন করতে নিচের বাটনে ক্লিক করুন"})]}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600",children:"পেমেন্টের পরিমাণ:"}),a.jsxs("span",{className:"text-2xl font-bold text-pink-600",children:[o(h)," টাকা"]})]})}),a.jsxs("div",{className:"bg-pink-50 border border-pink-200 rounded-lg p-4 mb-6",children:[a.jsx("h3",{className:"font-medium text-pink-800 mb-2",children:"অর্ডার সামারি:"}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"রোগীর নাম:"})," ",V.patient_name]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"মোবাইল:"})," ",V.patient_phone]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"তারিখ:"})," ",V.appointment_date]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"ডাক্তার:"})," ",u.name]})]})]}),C&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:a.jsx("p",{className:"text-red-700 text-sm",children:C})}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("button",{onClick:()=>I("form"),className:"flex-1 py-3 border border-gray-300 rounded-xl font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"ফিরে যান"}),a.jsx("button",{onClick:async function(){N(!0),D("");try{sessionStorage.setItem("pendingPaidAppointment",JSON.stringify({formData:V,doctorId:m,doctorName:u?.name,doctorCategory:u?.category_name,doctorChamberAddress:u?.chamber_address}));const e=await fetch("/api/bkash/create-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:h,payerReference:V.patient_phone,merchantInvoiceNumber:"PAID"+Date.now().toString().slice(-8)})}),t=await e.json();t.success&&t.bkashURL?window.location.href=t.bkashURL:(sessionStorage.removeItem("pendingPaidAppointment"),D(t.message||"পেমেন্ট শুরু করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।"))}catch(e){sessionStorage.removeItem("pendingPaidAppointment"),D("পেমেন্ট শুরু করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।")}finally{N(!1)}},disabled:y,className:"flex-1 py-3 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white rounded-xl font-semibold transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:y?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"প্রক্রিয়াকরণ..."]}):"বিকাশে পে করুন"})]})]})]})]}):a.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-16 text-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ডাক্তার পাওয়া যায়নি"}),a.jsx(n,{to:"/rangpur-specialist-doctors-list-online-serial",className:"btn-primary mt-4 inline-block",children:"ফিরে যান"})]})}export{g as default};
