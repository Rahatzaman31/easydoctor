import{g as e,r,j as t}from"./react-vendor-DK4SYnaI.js";import{s,i as a}from"./index-DdJT-0ac.js";import{D as n}from"./DoctorAdminSidebar-DiPHoZhi.js";import"./vendor-Ct5Y5_H5.js";import"./editor-vendor-DQbJo6Zw.js";import"./supabase-vendor-CZ5UGAb5.js";function d(){const d=e(),[i,o]=r.useState([]),[c,l]=r.useState(""),[m,u]=r.useState(!0),[x,h]=r.useState(!1),f=r.useRef(null),p=r.useRef(null),g=localStorage.getItem("doctorId");return r.useEffect(()=>{if(localStorage.getItem("doctorLoggedIn"))return async function(){try{if(!s||!a||!g)return void u(!1);const{data:e,error:r}=await s.from("chat_messages").select("*").eq("doctor_id",g).order("created_at",{ascending:!0});if(r)throw r;o(e||[])}catch(e){}finally{u(!1)}}(),async function(){try{if(!s||!a||!g)return;await s.from("chat_messages").update({is_read:!0}).eq("doctor_id",g).eq("sender_type","admin").eq("is_read",!1)}catch(e){}}(),function(){if(!s||!a||!g)return;p.current=s.channel(`doctor-chat-${g}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`doctor_id=eq.${g}`},e=>{o(r=>[...r,e.new]),"admin"===e.new.sender_type&&async function(e){try{if(!s||!a)return;await s.from("chat_messages").update({is_read:!0}).eq("id",e)}catch(r){}}(e.new.id)}).subscribe()}(),()=>{p.current&&p.current.unsubscribe()};d("/doctor.admin/login")},[]),r.useEffect(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[i]),t.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[t.jsx(n,{}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsxs("div",{className:"p-4 lg:p-6 border-b border-gray-200 bg-white",children:[t.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-800",children:"‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü"}),t.jsx("p",{className:"text-gray-500 mt-1",children:"‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®"})]}),m?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[0===i.length?t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx("div",{className:"text-6xl mb-4",children:"üí¨"}),t.jsx("p",{className:"text-lg",children:"‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶®‡ßá‡¶á"}),t.jsx("p",{className:"text-sm",children:"‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡ßã‡¶™‡¶ï‡¶•‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}):i.map(e=>{return t.jsx("div",{className:"flex "+("doctor"===e.sender_type?"justify-end":"justify-start"),children:t.jsxs("div",{className:"max-w-[75%] px-4 py-2 rounded-2xl "+("doctor"===e.sender_type?"bg-teal-600 text-white rounded-br-md":"bg-white text-gray-800 rounded-bl-md shadow-sm border border-gray-100"),children:[t.jsx("p",{className:"whitespace-pre-wrap",children:e.message}),t.jsx("p",{className:"text-xs mt-1 "+("doctor"===e.sender_type?"text-teal-200":"text-gray-400"),children:(r=e.created_at,new Date(r).toLocaleString("bn-BD",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit",hour12:!0}))})]})},e.id);var r}),t.jsx("div",{ref:f})]}),t.jsx("form",{onSubmit:async function(e){if(e.preventDefault(),c.trim()&&!x){h(!0);try{if(!s||!a)return void alert("‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á");const{error:e}=await s.from("chat_messages").insert([{doctor_id:g,sender_type:"doctor",message:c.trim(),is_read:!1}]);if(e)throw e;l("")}catch(r){alert("‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá")}finally{h(!1)}}},className:"p-4 bg-white border-t border-gray-200",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:c,onChange:e=>l(e.target.value),placeholder:"‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...",className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent"}),t.jsxs("button",{type:"submit",disabled:!c.trim()||x,className:"px-6 py-3 bg-teal-600 text-white rounded-xl font-medium hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[x?t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"‡¶™‡¶æ‡¶†‡¶æ‡¶®"]})]})})]})]})]})}export{d as default};
