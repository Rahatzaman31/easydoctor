import{f as e,g as t,r as a,j as s,L as n}from"./react-vendor-DK4SYnaI.js";import{s as r,i}from"./index-DdJT-0ac.js";import"./vendor-Ct5Y5_H5.js";import"./editor-vendor-DQbJo6Zw.js";import"./supabase-vendor-CZ5UGAb5.js";const l=e=>{const t=["০","১","২","৩","৪","৫","৬","৭","৮","৯"];return String(e).replace(/[0-9]/g,e=>t[parseInt(e)])},d={"রংপুর":["রংপুর সদর","গঙ্গাচড়া","তারাগঞ্জ","বদরগঞ্জ","মিঠাপুকুর","পীরগঞ্জ","কাউনিয়া","পীরগাছা"],"দিনাজপুর":["দিনাজপুর সদর","বীরগঞ্জ","বিরামপুর","বোচাগঞ্জ","চিরিরবন্দর","ফুলবাড়ী","ঘোড়াঘাট","হাকিমপুর","কাহারোল","খানসামা","নবাবগঞ্জ","পার্বতীপুর"],"কুড়িগ্রাম":["কুড়িগ্রাম সদর","উলিপুর","চিলমারী","নাগেশ্বরী","ভুরুঙ্গামারী","ফুলবাড়ী","রাজারহাট","রৌমারী","রাজীবপুর"],"লালমনিরহাট":["লালমনিরহাট সদর","আদিতমারী","কালীগঞ্জ","হাতীবান্ধা","পাটগ্রাম"],"নীলফামারী":["নীলফামারী সদর","সৈয়দপুর","ডোমার","ডিমলা","জলঢাকা","কিশোরগঞ্জ"],"গাইবান্ধা":["গাইবান্ধা সদর","গোবিন্দগঞ্জ","পলাশবাড়ী","সাদুল্লাপুর","সাঘাটা","সুন্দরগঞ্জ","ফুলছড়ি"],"ঠাকুরগাঁও":["ঠাকুরগাঁও সদর","পীরগঞ্জ","রাণীশংকৈল","হরিপুর","বালিয়াডাঙ্গী"],"পঞ্চগড়":["পঞ্চগড় সদর","বোদা","আটোয়ারী","দেবীগঞ্জ","তেতুলিয়া"]},o=Object.keys(d),m=[{id:"sunday",name:"রবি"},{id:"monday",name:"সোম"},{id:"tuesday",name:"মঙ্গল"},{id:"wednesday",name:"বুধ"},{id:"thursday",name:"বৃহঃ"},{id:"friday",name:"শুক্র"},{id:"saturday",name:"শনি"}],c=e=>["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()],x=()=>{var e;const t=[],a=new Date;for(let s=1;s<=8;s++){const n=new Date(a);n.setDate(a.getDate()+s);const r=c(n),i=(null==(e=m.find(e=>e.id===r))?void 0:e.name)||"";t.push({date:n,dateStr:n.toISOString().split("T")[0],dayId:r,dayName:i,dayNum:n.getDate(),month:n.toLocaleDateString("bn-BD",{month:"short"})})}return t};function p(){var m;const{doctorId:c}=e();t();const[p,u]=a.useState(null),[h,f]=a.useState(!0),[g,y]=a.useState(!1),[j,b]=a.useState(!1),[v,N]=a.useState(""),[w,_]=a.useState({}),[S,k]=a.useState(!1),[C,D]=a.useState(null),[q,L]=a.useState({top:0,left:0}),[X,z]=a.useState({patient_name:"",patient_phone:"",patient_age:"",patient_gender:"male",district:"",upazila:"",appointment_date:"",problem_description:""});function I(e){const{name:t,value:a}=e.target;z("district"===t?{...X,district:a,upazila:""}:{...X,[t]:a})}a.useEffect(()=>{!async function(){try{if(!r||!i)return void f(!1);let e,t;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(c)){const a=await r.from("doctors").select("*").eq("id",c).single();e=a.data,t=a.error}else{const a=await r.from("doctors").select("*").eq("slug",c).single();if(e=a.data,t=a.error,t&&!e){const a=await r.from("doctors").select("*").eq("id",c).single();e=a.data,t=a.error}}if(t)throw t;u(e)}catch(e){}finally{f(!1)}}()},[c]),a.useEffect(()=>{p&&async function(){try{if(!r||!i||!p)return;const e=x().map(e=>e.dateStr),{data:t,error:a}=await r.from("appointments").select("appointment_date").eq("doctor_id",c).in("appointment_date",e),{data:s,error:n}=await r.from("paid_appointments").select("appointment_date").eq("doctor_id",c).in("appointment_date",e);if(a||n)return;const l={};e.forEach(e=>{const a=(null==t?void 0:t.filter(t=>t.appointment_date===e).length)||0,n=(null==s?void 0:s.filter(t=>t.appointment_date===e).length)||0;l[e]=a+n}),_(l)}catch(e){}}()},[p]);const B=new Date;return B.setDate(B.getDate()+1),B.toISOString().split("T")[0],h?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):j?s.jsx("div",{className:"max-w-lg mx-auto px-4 py-16 text-center",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[s.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"সিরিয়াল সফল হয়েছে!"}),s.jsx("p",{className:"text-gray-600 mb-2",children:"আপনার বুকিং রেফারেন্স নম্বর:"}),s.jsx("p",{className:"text-3xl font-bold text-primary-600 mb-6",children:v}),s.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"এই নম্বরটি সংরক্ষণ করুন। চেম্বারে এটি দেখাতে হবে।"}),s.jsxs("div",{className:"flex gap-4 justify-center",children:[s.jsx(n,{to:"/",className:"btn-secondary",children:"হোমে যান"}),s.jsx(n,{to:"/rangpur-specialist-doctors-list-online-serial",className:"btn-primary",children:"আরো ডাক্তার দেখুন"})]})]})}):p?s.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[s.jsxs(n,{to:`/doctor/${(null==p?void 0:p.slug)||c}`,className:"text-primary-600 hover:underline mb-6 inline-flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ফিরে যান"]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[s.jsxs("div",{className:"bg-primary-600 p-6 text-white",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"সিরিয়াল নিন"}),s.jsxs("p",{className:"text-primary-200 mt-1",children:[p.name," - ",p.category_name]})]}),s.jsxs("form",{onSubmit:async function(e){if(e.preventDefault(),X.appointment_date){y(!0);try{if(!r||!i)return alert("ডাটাবেস সংযোগ নেই। অনুগ্রহ করে পরে চেষ্টা করুন।"),void y(!1);const e="RD"+Date.now().toString().slice(-8),{error:t}=await r.from("appointments").insert([{doctor_id:c,doctor_name:p.name,...X,booking_ref:e,status:"pending"}]);if(t)throw t;N(e),b(!0)}catch(t){alert("বুকিং করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।")}finally{y(!1)}}else alert("অনুগ্রহ করে অ্যাপয়েন্টমেন্টের তারিখ নির্বাচন করুন।")},className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"রোগীর নাম *"}),s.jsx("input",{type:"text",name:"patient_name",required:!0,className:"input-field",placeholder:"আপনার পুরো নাম লিখুন",value:X.patient_name,onChange:I})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"মোবাইল নম্বর *"}),s.jsx("input",{type:"tel",name:"patient_phone",required:!0,className:"input-field",placeholder:"01XXXXXXXXX",value:X.patient_phone,onChange:I})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"বয়স *"}),s.jsx("input",{type:"number",name:"patient_age",required:!0,min:"1",max:"120",className:"input-field",placeholder:"বছর",value:X.patient_age,onChange:I})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"লিঙ্গ *"}),s.jsxs("select",{name:"patient_gender",required:!0,className:"input-field",value:X.patient_gender,onChange:I,children:[s.jsx("option",{value:"male",children:"পুরুষ"}),s.jsx("option",{value:"female",children:"মহিলা"}),s.jsx("option",{value:"other",children:"অন্যান্য"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"জেলা *"}),s.jsxs("select",{name:"district",required:!0,className:"input-field",value:X.district,onChange:I,children:[s.jsx("option",{value:"",children:"জেলা নির্বাচন করুন"}),o.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"উপজেলা *"}),s.jsxs("select",{name:"upazila",required:!0,className:"input-field",value:X.upazila,onChange:I,disabled:!X.district,children:[s.jsx("option",{value:"",children:X.district?"উপজেলা নির্বাচন করুন":"প্রথমে জেলা নির্বাচন করুন"}),X.district&&(null==(m=d[X.district])?void 0:m.map(e=>s.jsx("option",{value:e,children:e},e)))]})]})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2 flex-wrap",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"অ্যাপয়েন্টমেন্টের তারিখ *"}),s.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-primary-50 to-primary-100 border border-primary-200 px-3 py-1.5 rounded-lg",children:[s.jsx("svg",{className:"w-4 h-4 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),X.appointment_date&&C?s.jsxs("span",{className:"text-sm font-medium text-primary-700",children:["অবশিষ্ট সিরিয়াল: ",C.limit?s.jsxs("span",{className:"font-bold",children:[l(C.remaining)," টি"]}):s.jsx("span",{children:"সীমাহীন"})]}):s.jsxs("span",{className:"text-sm font-medium text-primary-600",children:["দৈনিক লিমিট: ",(null==p?void 0:p.daily_appointment_limit)?s.jsxs("span",{className:"font-bold",children:[l(p.daily_appointment_limit)," টি"]}):s.jsx("span",{children:"সীমাহীন"})]})]})]}),s.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:(()=>{const e=x();let t=[];try{t=(null==p?void 0:p.schedule_days)?JSON.parse(p.schedule_days):[]}catch(n){t=[]}const a=null==p?void 0:p.daily_appointment_limit;return e.map(e=>{const n=t.length>0&&!t.includes(e.dayId),r=w[e.dateStr]||0,i=a&&r>=a,d=X.appointment_date===e.dateStr,o=n||i;return s.jsx("button",{type:"button",disabled:o,onClick:t=>!o&&function(e,t){if(t)return;const a=null==p?void 0:p.daily_appointment_limit,s=w[e.dateStr]||0,n=a?a-s:null;z({...X,appointment_date:e.dateStr}),D({date:e.dateStr,dayNum:e.dayNum,month:e.month,remaining:n,limit:a})}(e,i),className:"relative p-2.5 sm:p-3 rounded-xl border-2 text-center transition-all duration-200 "+(i?"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-300 text-orange-500 cursor-not-allowed":n?"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 text-gray-400 cursor-not-allowed":d?"bg-gradient-to-br from-primary-500 to-primary-600 border-primary-500 text-white shadow-xl shadow-primary-200 scale-[1.03] ring-2 ring-primary-300 ring-offset-1":"bg-white border-gray-200 text-gray-700 hover:border-primary-400 hover:bg-gradient-to-br hover:from-primary-50 hover:to-white hover:shadow-md"),children:i?s.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[s.jsx("div",{className:"text-[10px] sm:text-xs font-medium text-orange-600 mb-0.5",children:e.dayName}),s.jsx("div",{className:"text-base sm:text-lg font-bold text-orange-500",children:l(e.dayNum)}),s.jsx("div",{className:"text-[9px] sm:text-[10px] font-semibold text-orange-400 bg-orange-100 px-1.5 py-0.5 rounded mt-0.5",children:"পূর্ণ"})]}):n?s.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[s.jsx("div",{className:"text-[10px] sm:text-xs font-medium text-gray-400 mb-0.5",children:e.dayName}),s.jsx("div",{className:"text-base sm:text-lg font-bold text-gray-400",children:l(e.dayNum)}),s.jsx("div",{className:"text-[9px] sm:text-[10px] font-medium text-gray-400",children:"বন্ধ"})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[60px]",children:[s.jsx("div",{className:"text-[10px] sm:text-xs font-semibold mb-0.5 "+(d?"text-primary-100":"text-primary-500"),children:e.dayName}),s.jsx("div",{className:"text-xl sm:text-2xl font-bold leading-none "+(d?"text-white":"text-gray-800"),children:l(e.dayNum)}),s.jsx("div",{className:"text-[10px] sm:text-xs "+(d?"text-primary-100":"text-gray-500"),children:e.month})]})},e.dateStr)})})()}),!X.appointment_date&&s.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"উপরে থেকে তারিখ নির্বাচন করুন"}),s.jsx("input",{type:"hidden",name:"appointment_date",required:!0,value:X.appointment_date})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"সমস্যার বিবরণ"}),s.jsx("textarea",{name:"problem_description",rows:"3",className:"input-field",placeholder:"আপনার সমস্যা সংক্ষেপে লিখুন (ঐচ্ছিক)",value:X.problem_description,onChange:I})]}),s.jsx("button",{type:"submit",disabled:g,className:"btn-primary w-full py-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:g?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"প্রক্রিয়াকরণ হচ্ছে..."]}):"সিরিয়াল নিশ্চিত করুন"})]})]})]}):s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-16 text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ডাক্তার পাওয়া যায়নি"}),s.jsx(n,{to:"/rangpur-specialist-doctors-list-online-serial",className:"btn-primary mt-4 inline-block",children:"ফিরে যান"})]})}export{p as default};
